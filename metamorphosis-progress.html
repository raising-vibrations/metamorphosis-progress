<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Metamorphosis Progress</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --dark-gray: #252525;
      --snow-white: #FFFAFA;
      --golden-yellow: #efbf04;
      --deep-blue: #272757;
      --light-gray: #e0e0e0;
      --medium-gray: #888;
      --transition-standard: all 0.3s ease;
    }
    
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    
    body {
      font-family: 'Inter', 'Segoe UI', sans-serif;
      background-color: var(--snow-white);
      color: var(--dark-gray);
      min-height: 100vh;
      padding: 0;
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }
    
    .header {
      background-color: var(--deep-blue);
      color: var(--snow-white);
      padding: 1.5rem;
      text-align: center;
      border-bottom: 4px solid var(--golden-yellow);
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: -10px;
      right: -10px;
      width: 100px;
      height: 100px;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      transform: scale(0);
      animation: pulse 8s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(0); opacity: 0.3; }
      50% { transform: scale(3); opacity: 0.1; }
    }
    
    .logo {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .logo-icon {
      display: inline-block;
      transform-origin: center;
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .logo:hover .logo-icon {
      transform: rotate(360deg) scale(1.2);
    }
    
    .container {
      max-width: 900px;
      width: 90%;
      margin: 2rem auto;
      background: var(--snow-white);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      transition: var(--transition-standard);
    }
    
    .container:hover {
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
    }
    
    h1, h2, h3 { 
      color: var(--deep-blue); 
      margin-bottom: 1rem; 
    }
    
    h1 {
      font-size: 2rem;
      text-align: center;
    }
    
    h2 {
      font-size: 1.6rem;
      position: relative;
      display: inline-block;
    }
    
    h2::after {
      content: '';
      position: absolute;
      width: 30%;
      height: 3px;
      background-color: var(--golden-yellow);
      bottom: -5px;
      left: 0;
      transition: width 0.3s ease;
    }
    
    h2:hover::after {
      width: 100%;
    }
    
    h3 {
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .client-info {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1rem;
      border-radius: 12px;
      background-color: rgba(239, 191, 4, 0.08);
    }
    
    .progress-container { 
      margin: 2.5rem 0; 
      position: relative;
    }
    
    .progress-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
      font-weight: 500;
    }
    
    .progress-bar { 
      background: var(--light-gray); 
      border-radius: 12px;
      overflow: hidden; 
      height: 16px; 
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .progress-fill { 
      background: linear-gradient(90deg, var(--golden-yellow), var(--deep-blue)); 
      height: 100%; 
      transition: width 1s cubic-bezier(0.22, 1, 0.36, 1);
      position: relative;
      overflow: hidden;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        90deg, 
        transparent, 
        rgba(255, 255, 255, 0.3), 
        transparent
      );
      transform: translateX(-100%);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      100% { transform: translateX(100%); }
    }
    
    .step-list { 
      display: grid; 
      gap: 1.5rem; 
      margin-top: 3rem;
    }
    
    .step-item { 
      background: var(--snow-white); 
      padding: 1.5rem;
      border-radius: 12px;
      border-left: 5px solid var(--medium-gray);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: var(--transition-standard);
      position: relative;
      overflow: hidden;
    }
    
    .step-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(239, 191, 4, 0.02);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease-out;
      z-index: -1;
    }
    
    .step-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
    }
    
    .step-item:hover::before {
      transform: scaleX(1);
    }
    
    .step-item.completed { 
      border-left-color: var(--deep-blue); 
    }
    
    .step-item.current { 
      border-left-color: var(--golden-yellow); 
      font-weight: 500;
    }
    
    .step-item.upcoming { 
      border-left-color: var(--medium-gray); 
      opacity: 0.85;
    }
    
    .step-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    
    @media (min-width: 768px) {
      .step-content {
        grid-template-columns: auto 1fr;
        gap: 1.5rem;
        align-items: center;
      }
    }
    
    .step-icon {
      font-size: 2rem;
      color: var(--deep-blue);
      background-color: rgba(239, 191, 4, 0.15);
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin-bottom: 1rem;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .step-icon svg, .step-icon .custom-icon {
      width: 32px;
      height: 32px;
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .step-item:hover .step-icon svg, .step-item:hover .step-icon .custom-icon {
      transform: rotate(10deg) scale(1.1);
    }
    
    @media (min-width: 768px) {
      .step-icon {
        margin-bottom: 0;
      }
    }
    
    .step-item:hover .step-icon {
      transform: scale(1.1);
      background-color: rgba(239, 191, 4, 0.25);
    }
    
    .step-item.completed .step-icon {
      background-color: rgba(39, 39, 87, 0.15);
    }
    
    .step-details {
      flex: 1;
    }
    
    .step-description {
      margin-bottom: 1rem;
      color: var(--dark-gray);
    }
    
    .step-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      margin-top: 1rem;
    }
    
    .download-button { 
      padding: 8px 16px; 
      background: var(--deep-blue); 
      color: var(--snow-white); 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(39, 39, 87, 0.1);
    }
    
    .download-button:hover { 
      background: var(--golden-yellow);
      box-shadow: 0 6px 12px rgba(239, 191, 4, 0.3);
      transform: translateY(-2px);
    }
    
    .download-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(239, 191, 4, 0.3);
    }
    
    .download-button i {
      transition: transform 0.3s ease;
    }
    
    .download-button:hover i {
      transform: translateY(2px);
    }
    
    .completion-container {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
    }
    
    .completion-checkbox {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .completion-label {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      font-weight: 500;
      color: var(--deep-blue);
      transition: var(--transition-standard);
    }
    
    .checkbox-custom {
      width: 22px;
      height: 22px;
      border: 2px solid var(--medium-gray);
      border-radius: 6px;
      display: inline-block;
      position: relative;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .completion-checkbox:checked + .checkbox-custom {
      background-color: var(--deep-blue);
      border-color: var(--deep-blue);
    }
    
    .checkbox-custom::after {
      content: '';
      position: absolute;
      left: 7px;
      top: 3px;
      width: 5px;
      height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg) scale(0);
      opacity: 0;
      transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .completion-checkbox:checked + .checkbox-custom::after {
      opacity: 1;
      transform: rotate(45deg) scale(1);
    }
    
    .completion-checkbox:focus + .checkbox-custom {
      box-shadow: 0 0 0 3px rgba(39, 39, 87, 0.2);
    }
    
    .completion-label:hover .checkbox-custom {
      border-color: var(--deep-blue);
      transform: scale(1.05);
    }
    
    .note {
      font-size: 0.85rem;
      color: var(--deep-blue);
      margin-top: 0.5rem;
      display: flex;
      align-items: flex-start;
      gap: 0.25rem;
    }
    
    /* Accessible focus styles */
    a:focus, button:focus, .completion-checkbox:focus + .checkbox-custom {
      outline: 3px solid rgba(239, 191, 4, 0.5);
      outline-offset: 2px;
    }
    
    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-fadeInUp {
      animation: fadeInUp 0.8s ease forwards;
    }
    
    /* Mobile Responsive Adjustments */
    @media (max-width: 767px) {
      .container {
        width: 95%;
        padding: 1.5rem;
      }
      
      h1 {
        font-size: 1.75rem;
      }
      
      h2 {
        font-size: 1.4rem;
      }
      
      h3 {
        font-size: 1.2rem;
      }
      
      .step-item {
        padding: 1.25rem;
      }
      
      .step-icon {
        font-size: 1.75rem;
        width: 56px;
        height: 56px;
      }
      
      .download-button {
        padding: 7px 14px;
        font-size: 0.95rem;
      }
    }
    
    /* Screen reader only */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
    
    /* Footer styles */
    .footer {
      margin-top: auto;
      text-align: center;
      padding: 1.5rem;
      background-color: var(--deep-blue);
      color: var(--snow-white);
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <span class="logo-icon">🦋</span> 
      <span>Metamorphosis Program</span>
    </div>
    <p>Track your transformation journey</p>
  </header>

  <main class="container">
    <h1>Your Metamorphosis Progress</h1>
    <div id="client-name" class="client-info"></div>
    
    <div class="progress-container" id="progress-container">
      <div class="progress-stats">
        <span id="progress-text">Overall Progress</span>
        <span id="progress-percentage">0%</span>
      </div>
      <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
    </div>
    
    <div class="step-list" id="step-list"></div>
  </main>

  <footer class="footer">
    <p>&copy; 2025 Metamorphosis Program. All rights reserved.</p>
  </footer>

  <script>
    const phaseMap = {
      1: { 
        title: "Step 1 - Setting Intentions", 
        desc: "Identify what you want to accomplish in this program.", 
        file: "Setting Intentions.pdf",
        icon: '<i class="fas fa-seedling"></i>',
        stage: "caterpillar"
      },
      2: { 
        title: "Step 2 - Understanding Your Core Patterns", 
        desc: "Examine unconscious patterns via your Pluto placement.", 
        file: null, // Dynamic based on Pluto
        icon: '<img src="pluto.svg" alt="Pluto astrological symbol" class="custom-icon">',
        stage: "caterpillar"
      },
      3: { 
        title: "Step 3 - Pluto Integration Session", 
        desc: "Discuss your patterns and plan actions in a 1:1 call.", 
        file: "Pluto Call Recording.mp4",
        icon: '<i class="fas fa-comments"></i>',
        stage: "caterpillar"
      },
      4: { 
        title: "Step 4 - Shadow Work", 
        desc: "Dive deeper into your inner transformation.", 
        file: null,
        icon: '<i class="fas fa-moon"></i>',
        stage: "cocoon"
      },
      5: { 
        title: "Step 5 - Growth & Integration", 
        desc: "Integrate your insights for personal growth.", 
        file: null,
        icon: '<i class="fas fa-leaf"></i>',
        stage: "cocoon"
      },
      6: { 
        title: "Step 6 - Nodal Integration", 
        desc: "Align with your life's purpose.", 
        file: null,
        icon: '<i class="fas fa-compass"></i>',
        stage: "butterfly"
      },
      7: { 
        title: "Step 7 - Completion", 
        desc: "Celebrate your transformation!", 
        file: null,
        icon: '<i class="fas fa-award"></i>',
        stage: "butterfly"
      }
    };

    // Set animation delay for elements
    function setAnimationDelays() {
      const items = document.querySelectorAll('.step-item');
      items.forEach((item, index) => {
        item.style.animationDelay = `${index * 0.1}s`;
        item.classList.add('animate-fadeInUp');
      });
    }

    function loadClients() {
      return JSON.parse(localStorage.getItem('clients') || '[]');
    }

    function getClientData() {
      const urlParams = new URLSearchParams(window.location.search);
      const clientName = urlParams.get('name');
      const clients = loadClients();
      return clients.find(client => client.name === clientName) || null;
    }

    function formatDate(date) {
      const day = date.getDate();
      const month = date.toLocaleString('default', { month: 'long' });
      const year = date.getFullYear();
      const suffix = (day % 10 === 1 && day !== 11) ? 'st' : (day % 10 === 2 && day !== 12) ? 'nd' : (day % 10 === 3 && day !== 13) ? 'rd' : 'th';
      return `${day}${suffix} ${month} ${year}`;
    }

    function saveClientProgress(clientName, step, checked) {
      const progress = JSON.parse(localStorage.getItem('clientProgress') || '{}');
      progress[clientName] = progress[clientName] || {};
      progress[clientName][step] = checked;
      localStorage.setItem('clientProgress', JSON.stringify(progress));
      
      // Update UI after saving
      updateProgressDisplay(clientName);
    }

    function loadClientProgress(clientName) {
      const progress = JSON.parse(localStorage.getItem('clientProgress') || '{}');
      return progress[clientName] || {};
    }
    
    function updateProgressDisplay(clientName) {
      const clientProgress = loadClientProgress(clientName);
      const completedCount = Object.values(clientProgress).filter(Boolean).length;
      const percent = Math.floor((completedCount / 7) * 100);
      
      const progressFill = document.getElementById('progress-fill');
      const progressPercentage = document.getElementById('progress-percentage');
      const progressBar = document.querySelector('.progress-bar');
      
      progressFill.style.width = `${percent}%`;
      progressPercentage.textContent = `${percent}%`;
      progressBar.setAttribute('aria-valuenow', percent);
      
      // Update completed checkboxes visual state
      Object.entries(clientProgress).forEach(([step, isCompleted]) => {
        const checkbox = document.querySelector(`#step-${step}-checkbox`);
        if (checkbox) {
          checkbox.checked = isCompleted;
        }
      });
    }

    function getStageEmoji(stage) {
      if (stage === 'caterpillar') return '🐛';
      if (stage === 'cocoon') return '🧬';
      if (stage === 'butterfly') return '🦋';
      return '';
    }

    function renderProgress() {
      const client = getClientData();
      if (!client) {
        document.getElementById('client-name').innerHTML = "<p>Client not found. Please check your link.</p>";
        return;
      }

      document.getElementById('client-name').innerHTML = `
        <h2>${client.name}</h2>
        <p>Journey began: ${formatDate(new Date(client.startDate))}</p>
      `;
      
      const phase = parseInt(client.phase);
      const stepList = document.getElementById('step-list');
      
      for (let i = 1; i <= 7; i++) {
        const stepData = phaseMap[i];
        const step = document.createElement('div');
        step.className = 'step-item';
        step.classList.add(i < phase ? 'completed' : i === phase ? 'current' : 'upcoming');
        
        let extraContent = '';
        if (i === 1 && stepData.file) {
          extraContent = `
            <button class="download-button" onclick="window.open('${stepData.file}', '_blank')">
              <i class="fas fa-download"></i> Download Worksheet
            </button>
          `;
        } else if (i === 2 && phase >= 2) {
          extraContent = `
            <button class="download-button" onclick="window.open('Pluto ${client.pluto}.pdf', '_blank')">
              <i class="fas fa-download"></i> Download Pluto Worksheet
            </button>
          `;
        } else if (i === 3 && phase >= 3) {
          extraContent = `
            <button class="download-button" onclick="window.open('${stepData.file}', '_blank')">
              <i class="fas fa-download"></i> Download Call Recording
            </button>
            <div class="note">
              <i class="fas fa-info-circle"></i>
              <span>The call recording is available for one week.</span>
            </div>
          `;
        }
        
        // Add call scheduling link if phase 3 and current
        if (i === 3 && i === phase) {
          extraContent += `
            <a href="https://scheduler.zoom.us/raising-vibrations-simon/metamorphosis-pluto-session-zcj9mlex" 
               class="download-button" style="background: var(--golden-yellow);">
              <i class="fas fa-calendar-alt"></i> Schedule Your Session
            </a>
          `;
        }
        
        step.innerHTML = `
          <div class="step-content">
            <div class="step-icon">
              ${stepData.icon}
              <span class="sr-only">${stepData.stage}</span>
            </div>
            <div class="step-details">
              <h3>${getStageEmoji(stepData.stage)} ${stepData.title}</h3>
              <p class="step-description">${stepData.desc}</p>
              <div class="step-actions">
                ${extraContent}
                <div class="completion-container">
                  <input type="checkbox" id="step-${i}-checkbox" class="completion-checkbox" 
                         onchange="saveClientProgress('${client.name}', ${i}, this.checked)" 
                         aria-label="Mark step ${i} as completed">
                  <label for="step-${i}-checkbox" class="completion-label">
                    <span class="checkbox-custom"></span>
                    <span>Completed</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        `;
        
        stepList.appendChild(step);
      }
      
      // Initialize progress display
      updateProgressDisplay(client.name);
      
      // Set animation delays after rendering
      setAnimationDelays();
      
      // For testing - mock data if none exists
      if (!localStorage.getItem('clients') || JSON.parse(localStorage.getItem('clients')).length === 0) {
        const mockData = [
          {
            name: 'Jane Doe',
            startDate: '2025-01-15',
            phase: 3,
            pluto: '4th House'
          }
        ];
        localStorage.setItem('clients', JSON.stringify(mockData));
        
        // Set sample progress
        const sampleProgress = {
          'Jane Doe': {
            '1': true,
            '2': true
          }
        };
        localStorage.setItem('clientProgress', JSON.stringify(sampleProgress));
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      renderProgress();
    });
  </script>
</body>
</html>